{
  "version": "1.0",
  "database": "KTC Logistics System",
  "description": "Complete data model for KTC Logistics Management System",
  "entities": [
    {
      "name": "User",
      "tableName": "users",
      "description": "System users including dispatchers, drivers, admins",
      "fields": [
        { "name": "id", "type": "BIGINT", "primary": true, "autoIncrement": true, "nullable": false },
        { "name": "name", "type": "VARCHAR(255)", "nullable": false },
        { "name": "email", "type": "VARCHAR(255)", "nullable": false, "unique": true },
        { "name": "password", "type": "VARCHAR(255)", "nullable": false },
        { "name": "role", "type": "ENUM", "values": ["ADMIN", "DISPATCHER", "DRIVER", "CUSTOMER_SERVICE"], "nullable": false },
        { "name": "phone", "type": "VARCHAR(20)" },
        { "name": "address", "type": "TEXT" },
        { "name": "isActive", "type": "BOOLEAN", "default": true, "nullable": false },
        { "name": "createdAt", "type": "TIMESTAMP", "nullable": false },
        { "name": "updatedAt", "type": "TIMESTAMP", "nullable": false }
      ],
      "indexes": [
        { "name": "idx_user_email", "fields": ["email"], "unique": true },
        { "name": "idx_user_role", "fields": ["role"] }
      ]
    },
    {
      "name": "Customer",
      "tableName": "customers",
      "description": "Customer information for delivery orders",
      "fields": [
        { "name": "id", "type": "BIGINT", "primary": true, "autoIncrement": true, "nullable": false },
        { "name": "name", "type": "VARCHAR(255)", "nullable": false },
        { "name": "email", "type": "VARCHAR(255)", "unique": true },
        { "name": "phone", "type": "VARCHAR(20)", "nullable": false },
        { "name": "address", "type": "TEXT" },
        { "name": "company", "type": "VARCHAR(255)" },
        { "name": "contactPerson", "type": "VARCHAR(255)" },
        { "name": "isActive", "type": "BOOLEAN", "default": true, "nullable": false },
        { "name": "createdAt", "type": "TIMESTAMP", "nullable": false },
        { "name": "updatedAt", "type": "TIMESTAMP", "nullable": false }
      ],
      "indexes": [
        { "name": "idx_customer_email", "fields": ["email"], "unique": true },
        { "name": "idx_customer_phone", "fields": ["phone"] }
      ]
    },
    {
      "name": "Vehicle",
      "tableName": "vehicles",
      "description": "Fleet vehicle information",
      "fields": [
        { "name": "id", "type": "BIGINT", "primary": true, "autoIncrement": true, "nullable": false },
        { "name": "licensePlate", "type": "VARCHAR(20)", "nullable": false, "unique": true },
        { "name": "vehicleType", "type": "VARCHAR(50)" },
        { "name": "capacity", "type": "DOUBLE", "comment": "Load capacity in tons" },
        { "name": "fuelType", "type": "VARCHAR(20)" },
        { "name": "status", "type": "ENUM", "values": ["AVAILABLE", "IN_USE", "MAINTENANCE", "OUT_OF_SERVICE"], "nullable": false, "default": "AVAILABLE" },
        { "name": "registrationDate", "type": "TIMESTAMP" },
        { "name": "lastMaintenanceDate", "type": "TIMESTAMP" },
        { "name": "createdAt", "type": "TIMESTAMP", "nullable": false },
        { "name": "updatedAt", "type": "TIMESTAMP", "nullable": false }
      ],
      "indexes": [
        { "name": "idx_vehicle_license", "fields": ["licensePlate"], "unique": true },
        { "name": "idx_vehicle_status", "fields": ["status"] }
      ]
    },
    {
      "name": "DeliveryOrder",
      "tableName": "delivery_orders",
      "description": "Delivery order records",
      "fields": [
        { "name": "id", "type": "BIGINT", "primary": true, "autoIncrement": true, "nullable": false },
        { "name": "orderCode", "type": "VARCHAR(50)", "nullable": false, "unique": true },
        { "name": "status", "type": "ENUM", "values": ["PENDING", "ASSIGNED", "IN_TRANSIT", "DELIVERED", "CANCELLED", "FAILED"], "nullable": false, "default": "PENDING" },
        { "name": "pickupAddress", "type": "TEXT" },
        { "name": "deliveryAddress", "type": "TEXT", "nullable": false },
        { "name": "customerName", "type": "VARCHAR(255)" },
        { "name": "customerPhone", "type": "VARCHAR(20)" },
        { "name": "description", "type": "TEXT" },
        { "name": "scheduledTime", "type": "TIMESTAMP" },
        { "name": "actualDeliveryTime", "type": "TIMESTAMP" },
        { "name": "createdAt", "type": "TIMESTAMP", "nullable": false },
        { "name": "updatedAt", "type": "TIMESTAMP", "nullable": false },
        { "name": "createdBy", "type": "BIGINT", "foreignKey": { "table": "User", "field": "id" } },
        { "name": "customerId", "type": "BIGINT", "foreignKey": { "table": "Customer", "field": "id" } },
        { "name": "assignedVehicleId", "type": "BIGINT", "foreignKey": { "table": "Vehicle", "field": "id" } },
        { "name": "assignedDriverId", "type": "BIGINT", "foreignKey": { "table": "User", "field": "id" } },
        { "name": "routeId", "type": "BIGINT", "foreignKey": { "table": "Route", "field": "id" } }
      ],
      "indexes": [
        { "name": "idx_order_code", "fields": ["orderCode"], "unique": true },
        { "name": "idx_order_status", "fields": ["status"] },
        { "name": "idx_order_created_by", "fields": ["createdBy"] },
        { "name": "idx_order_customer", "fields": ["customerId"] },
        { "name": "idx_order_vehicle", "fields": ["assignedVehicleId"] },
        { "name": "idx_order_driver", "fields": ["assignedDriverId"] }
      ]
    },
    {
      "name": "Route",
      "tableName": "routes",
      "description": "Delivery routes and route optimization data",
      "fields": [
        { "name": "id", "type": "BIGINT", "primary": true, "autoIncrement": true, "nullable": false },
        { "name": "name", "type": "VARCHAR(255)", "nullable": false },
        { "name": "startAddress", "type": "TEXT", "nullable": false },
        { "name": "endAddress", "type": "TEXT", "nullable": false },
        { "name": "startLatitude", "type": "DECIMAL(10,8)" },
        { "name": "startLongitude", "type": "DECIMAL(11,8)" },
        { "name": "endLatitude", "type": "DECIMAL(10,8)" },
        { "name": "endLongitude", "type": "DECIMAL(11,8)" },
        { "name": "estimatedDistance", "type": "DOUBLE", "comment": "Distance in kilometers" },
        { "name": "estimatedDuration", "type": "INTEGER", "comment": "Duration in minutes" },
        { "name": "actualDistance", "type": "DOUBLE" },
        { "name": "actualDuration", "type": "INTEGER" },
        { "name": "optimizationScore", "type": "DOUBLE" },
        { "name": "createdAt", "type": "TIMESTAMP", "nullable": false },
        { "name": "updatedAt", "type": "TIMESTAMP", "nullable": false }
      ],
      "indexes": [
        { "name": "idx_route_coordinates", "fields": ["startLatitude", "startLongitude"] },
        { "name": "idx_route_optimization", "fields": ["optimizationScore"] }
      ]
    },
    {
      "name": "OrderTracking",
      "tableName": "order_tracking",
      "description": "Real-time order status tracking",
      "fields": [
        { "name": "id", "type": "BIGINT", "primary": true, "autoIncrement": true, "nullable": false },
        { "name": "status", "type": "VARCHAR(50)", "nullable": false },
        { "name": "latitude", "type": "DECIMAL(10,8)" },
        { "name": "longitude", "type": "DECIMAL(11,8)" },
        { "name": "address", "type": "TEXT" },
        { "name": "notes", "type": "TEXT" },
        { "name": "timestamp", "type": "TIMESTAMP", "nullable": false },
        { "name": "deliveryOrderId", "type": "BIGINT", "foreignKey": { "table": "DeliveryOrder", "field": "id" }, "nullable": false },
        { "name": "updatedBy", "type": "BIGINT", "foreignKey": { "table": "User", "field": "id" } }
      ],
      "indexes": [
        { "name": "idx_tracking_order", "fields": ["deliveryOrderId"] },
        { "name": "idx_tracking_timestamp", "fields": ["timestamp"] },
        { "name": "idx_tracking_location", "fields": ["latitude", "longitude"] }
      ]
    },
    {
      "name": "DispatchAssignment",
      "tableName": "dispatch_assignments",
      "description": "Driver and vehicle assignments for orders",
      "fields": [
        { "name": "id", "type": "BIGINT", "primary": true, "autoIncrement": true, "nullable": false },
        { "name": "assignedAt", "type": "TIMESTAMP", "nullable": false },
        { "name": "unassignedAt", "type": "TIMESTAMP" },
        { "name": "status", "type": "ENUM", "values": ["ACTIVE", "COMPLETED", "CANCELLED"], "nullable": false, "default": "ACTIVE" },
        { "name": "notes", "type": "TEXT" },
        { "name": "deliveryOrderId", "type": "BIGINT", "foreignKey": { "table": "DeliveryOrder", "field": "id" }, "nullable": false },
        { "name": "vehicleId", "type": "BIGINT", "foreignKey": { "table": "Vehicle", "field": "id" }, "nullable": false },
        { "name": "driverId", "type": "BIGINT", "foreignKey": { "table": "User", "field": "id" }, "nullable": false },
        { "name": "dispatcherId", "type": "BIGINT", "foreignKey": { "table": "User", "field": "id" }, "nullable": false }
      ],
      "indexes": [
        { "name": "idx_assignment_order", "fields": ["deliveryOrderId"] },
        { "name": "idx_assignment_vehicle", "fields": ["vehicleId"] },
        { "name": "idx_assignment_driver", "fields": ["driverId"] },
        { "name": "idx_assignment_status", "fields": ["status"] }
      ]
    },
    {
      "name": "DeliveryProof",
      "tableName": "delivery_proofs",
      "description": "Delivery confirmation documents and photos",
      "fields": [
        { "name": "id", "type": "BIGINT", "primary": true, "autoIncrement": true, "nullable": false },
        { "name": "proofType", "type": "ENUM", "values": ["PHOTO", "SIGNATURE", "RECEIPT", "DOCUMENT"], "nullable": false },
        { "name": "filePath", "type": "VARCHAR(500)" },
        { "name": "fileName", "type": "VARCHAR(255)" },
        { "name": "fileSize", "type": "BIGINT" },
        { "name": "mimeType", "type": "VARCHAR(100)" },
        { "name": "description", "type": "TEXT" },
        { "name": "latitude", "type": "DECIMAL(10,8)" },
        { "name": "longitude", "type": "DECIMAL(11,8)" },
        { "name": "capturedAt", "type": "TIMESTAMP", "nullable": false },
        { "name": "createdAt", "type": "TIMESTAMP", "nullable": false },
        { "name": "deliveryOrderId", "type": "BIGINT", "foreignKey": { "table": "DeliveryOrder", "field": "id" }, "nullable": false },
        { "name": "uploadedBy", "type": "BIGINT", "foreignKey": { "table": "User", "field": "id" }, "nullable": false }
      ],
      "indexes": [
        { "name": "idx_proof_order", "fields": ["deliveryOrderId"] },
        { "name": "idx_proof_type", "fields": ["proofType"] },
        { "name": "idx_proof_captured", "fields": ["capturedAt"] }
      ]
    },
    {
      "name": "VehicleMaintenance",
      "tableName": "vehicle_maintenance",
      "description": "Vehicle maintenance records",
      "fields": [
        { "name": "id", "type": "BIGINT", "primary": true, "autoIncrement": true, "nullable": false },
        { "name": "maintenanceType", "type": "ENUM", "values": ["ROUTINE", "REPAIR", "INSPECTION", "EMERGENCY"], "nullable": false },
        { "name": "description", "type": "TEXT", "nullable": false },
        { "name": "cost", "type": "DECIMAL(10,2)" },
        { "name": "maintenanceDate", "type": "TIMESTAMP", "nullable": false },
        { "name": "nextMaintenanceDate", "type": "TIMESTAMP" },
        { "name": "mileage", "type": "INTEGER" },
        { "name": "serviceProvider", "type": "VARCHAR(255)" },
        { "name": "invoiceNumber", "type": "VARCHAR(100)" },
        { "name": "status", "type": "ENUM", "values": ["SCHEDULED", "IN_PROGRESS", "COMPLETED", "CANCELLED"], "nullable": false, "default": "SCHEDULED" },
        { "name": "createdAt", "type": "TIMESTAMP", "nullable": false },
        { "name": "updatedAt", "type": "TIMESTAMP", "nullable": false },
        { "name": "vehicleId", "type": "BIGINT", "foreignKey": { "table": "Vehicle", "field": "id" }, "nullable": false },
        { "name": "creatorId", "type": "BIGINT", "foreignKey": { "table": "User", "field": "id" }, "nullable": false }
      ],
      "indexes": [
        { "name": "idx_maintenance_vehicle", "fields": ["vehicleId"] },
        { "name": "idx_maintenance_date", "fields": ["maintenanceDate"] },
        { "name": "idx_maintenance_status", "fields": ["status"] }
      ]
    },
    {
      "name": "Notification",
      "tableName": "notifications",
      "description": "System notifications for users",
      "fields": [
        { "name": "id", "type": "BIGINT", "primary": true, "autoIncrement": true, "nullable": false },
        { "name": "title", "type": "VARCHAR(255)", "nullable": false },
        { "name": "content", "type": "TEXT" },
        { "name": "notificationType", "type": "ENUM", "values": ["ORDER_ASSIGNED", "DELIVERY_COMPLETED", "MAINTENANCE_DUE", "ROUTE_OPTIMIZED", "SYSTEM_ALERT"], "nullable": false },
        { "name": "priorityLevel", "type": "ENUM", "values": ["LOW", "MEDIUM", "HIGH", "URGENT"], "nullable": false, "default": "MEDIUM" },
        { "name": "isRead", "type": "BOOLEAN", "default": false, "nullable": false },
        { "name": "readAt", "type": "TIMESTAMP" },
        { "name": "createdAt", "type": "TIMESTAMP", "nullable": false },
        { "name": "expiresAt", "type": "TIMESTAMP" },
        { "name": "userId", "type": "BIGINT", "foreignKey": { "table": "User", "field": "id" }, "nullable": false },
        { "name": "relatedOrderId", "type": "BIGINT", "foreignKey": { "table": "DeliveryOrder", "field": "id" } },
        { "name": "relatedVehicleId", "type": "BIGINT", "foreignKey": { "table": "Vehicle", "field": "id" } }
      ],
      "indexes": [
        { "name": "idx_notification_user", "fields": ["userId"] },
        { "name": "idx_notification_type", "fields": ["notificationType"] },
        { "name": "idx_notification_priority", "fields": ["priorityLevel"] },
        { "name": "idx_notification_read", "fields": ["isRead"] }
      ]
    },
    {
      "name": "KPIMetrics",
      "tableName": "kpi_metrics",
      "description": "Key Performance Indicators and metrics",
      "fields": [
        { "name": "id", "type": "BIGINT", "primary": true, "autoIncrement": true, "nullable": false },
        { "name": "metricName", "type": "VARCHAR(100)", "nullable": false },
        { "name": "metricValue", "type": "DECIMAL(15,4)", "nullable": false },
        { "name": "metricUnit", "type": "VARCHAR(20)" },
        { "name": "calculationDate", "type": "DATE", "nullable": false },
        { "name": "periodType", "type": "ENUM", "values": ["DAILY", "WEEKLY", "MONTHLY", "QUARTERLY", "YEARLY"], "nullable": false },
        { "name": "periodStart", "type": "DATE" },
        { "name": "periodEnd", "type": "DATE" },
        { "name": "targetValue", "type": "DECIMAL(15,4)" },
        { "name": "notes", "type": "TEXT" },
        { "name": "createdAt", "type": "TIMESTAMP", "nullable": false },
        { "name": "departmentId", "type": "BIGINT" },
        { "name": "userId", "type": "BIGINT", "foreignKey": { "table": "User", "field": "id" } },
        { "name": "vehicleId", "type": "BIGINT", "foreignKey": { "table": "Vehicle", "field": "id" } }
      ],
      "indexes": [
        { "name": "idx_kpi_metric_name", "fields": ["metricName"] },
        { "name": "idx_kpi_period", "fields": ["periodType", "calculationDate"] },
        { "name": "idx_kpi_user", "fields": ["userId"] },
        { "name": "idx_kpi_vehicle", "fields": ["vehicleId"] }
      ]
    },
    {
      "name": "AuditLog",
      "tableName": "audit_logs",
      "description": "System audit trail",
      "fields": [
        { "name": "id", "type": "BIGINT", "primary": true, "autoIncrement": true, "nullable": false },
        { "name": "action", "type": "VARCHAR(100)", "nullable": false },
        { "name": "entityType", "type": "VARCHAR(50)" },
        { "name": "entityId", "type": "BIGINT" },
        { "name": "oldValues", "type": "JSON" },
        { "name": "newValues", "type": "JSON" },
        { "name": "ipAddress", "type": "VARCHAR(45)" },
        { "name": "userAgent", "type": "TEXT" },
        { "name": "timestamp", "type": "TIMESTAMP", "nullable": false },
        { "name": "userId", "type": "BIGINT", "foreignKey": { "table": "User", "field": "id" }, "nullable": false }
      ],
      "indexes": [
        { "name": "idx_audit_user", "fields": ["userId"] },
        { "name": "idx_audit_timestamp", "fields": ["timestamp"] },
        { "name": "idx_audit_entity", "fields": ["entityType", "entityId"] },
        { "name": "idx_audit_action", "fields": ["action"] }
      ]
    },
    {
      "name": "PasswordResetToken",
      "tableName": "password_reset_tokens",
      "description": "Password reset tokens for user authentication",
      "fields": [
        { "name": "id", "type": "BIGINT", "primary": true, "autoIncrement": true, "nullable": false },
        { "name": "token", "type": "VARCHAR(255)", "nullable": false, "unique": true },
        { "name": "expiryDate", "type": "TIMESTAMP", "nullable": false },
        { "name": "isUsed", "type": "BOOLEAN", "default": false, "nullable": false },
        { "name": "usedAt", "type": "TIMESTAMP" },
        { "name": "createdAt", "type": "TIMESTAMP", "nullable": false },
        { "name": "userId", "type": "BIGINT", "foreignKey": { "table": "User", "field": "id" }, "nullable": false }
      ],
      "indexes": [
        { "name": "idx_reset_token", "fields": ["token"], "unique": true },
        { "name": "idx_reset_user", "fields": ["userId"] },
        { "name": "idx_reset_expiry", "fields": ["expiryDate"] }
      ]
    },
    {
      "name": "SystemConfig",
      "tableName": "system_configs",
      "description": "System configuration settings",
      "fields": [
        { "name": "id", "type": "BIGINT", "primary": true, "autoIncrement": true, "nullable": false },
        { "name": "configKey", "type": "VARCHAR(100)", "nullable": false, "unique": true },
        { "name": "configValue", "type": "TEXT" },
        { "name": "configType", "type": "ENUM", "values": ["STRING", "INTEGER", "BOOLEAN", "JSON", "DECIMAL"], "nullable": false },
        { "name": "description", "type": "TEXT" },
        { "name": "isActive", "type": "BOOLEAN", "default": true, "nullable": false },
        { "name": "isSystem", "type": "BOOLEAN", "default": false, "nullable": false },
        { "name": "category", "type": "VARCHAR(50)" },
        { "name": "createdAt", "type": "TIMESTAMP", "nullable": false },
        { "name": "updatedAt", "type": "TIMESTAMP", "nullable": false },
        { "name": "updatedBy", "type": "BIGINT", "foreignKey": { "table": "User", "field": "id" } }
      ],
      "indexes": [
        { "name": "idx_config_key", "fields": ["configKey"], "unique": true },
        { "name": "idx_config_category", "fields": ["category"] },
        { "name": "idx_config_active", "fields": ["isActive"] }
      ]
    }
  ],
  "relationships": [
    {
      "name": "user_audit_logs",
      "type": "one-to-many",
      "from": { "entity": "User", "field": "id" },
      "to": { "entity": "AuditLog", "field": "userId" }
    },
    {
      "name": "user_reset_tokens",
      "type": "one-to-many",
      "from": { "entity": "User", "field": "id" },
      "to": { "entity": "PasswordResetToken", "field": "userId" }
    },
    {
      "name": "user_created_orders",
      "type": "one-to-many",
      "from": { "entity": "User", "field": "id" },
      "to": { "entity": "DeliveryOrder", "field": "createdBy" }
    },
    {
      "name": "user_driver_assignments",
      "type": "one-to-many",
      "from": { "entity": "User", "field": "id" },
      "to": { "entity": "DispatchAssignment", "field": "driverId" }
    },
    {
      "name": "user_dispatcher_assignments",
      "type": "one-to-many",
      "from": { "entity": "User", "field": "id" },
      "to": { "entity": "DispatchAssignment", "field": "dispatcherId" }
    },
    {
      "name": "user_notifications",
      "type": "one-to-many",
      "from": { "entity": "User", "field": "id" },
      "to": { "entity": "Notification", "field": "userId" }
    },
    {
      "name": "customer_orders",
      "type": "one-to-many",
      "from": { "entity": "Customer", "field": "id" },
      "to": { "entity": "DeliveryOrder", "field": "customerId" }
    },
    {
      "name": "vehicle_orders",
      "type": "one-to-many",
      "from": { "entity": "Vehicle", "field": "id" },
      "to": { "entity": "DeliveryOrder", "field": "assignedVehicleId" }
    },
    {
      "name": "vehicle_assignments",
      "type": "one-to-many",
      "from": { "entity": "Vehicle", "field": "id" },
      "to": { "entity": "DispatchAssignment", "field": "vehicleId" }
    },
    {
      "name": "vehicle_maintenance",
      "type": "one-to-many",
      "from": { "entity": "Vehicle", "field": "id" },
      "to": { "entity": "VehicleMaintenance", "field": "vehicleId" }
    },
    {
      "name": "order_tracking",
      "type": "one-to-many",
      "from": { "entity": "DeliveryOrder", "field": "id" },
      "to": { "entity": "OrderTracking", "field": "deliveryOrderId" }
    },
    {
      "name": "order_assignments",
      "type": "one-to-many",
      "from": { "entity": "DeliveryOrder", "field": "id" },
      "to": { "entity": "DispatchAssignment", "field": "deliveryOrderId" }
    },
    {
      "name": "order_proofs",
      "type": "one-to-many",
      "from": { "entity": "DeliveryOrder", "field": "id" },
      "to": { "entity": "DeliveryProof", "field": "deliveryOrderId" }
    },
    {
      "name": "route_orders",
      "type": "one-to-many",
      "from": { "entity": "Route", "field": "id" },
      "to": { "entity": "DeliveryOrder", "field": "routeId" }
    }
  ],
  "constraints": [
    {
      "name": "unique_order_code",
      "type": "unique",
      "table": "delivery_orders",
      "fields": ["orderCode"]
    },
    {
      "name": "unique_vehicle_license",
      "type": "unique",
      "table": "vehicles",
      "fields": ["licensePlate"]
    },
    {
      "name": "unique_user_email",
      "type": "unique",
      "table": "users",
      "fields": ["email"]
    },
    {
      "name": "unique_config_key",
      "type": "unique",
      "table": "system_configs",
      "fields": ["configKey"]
    },
    {
      "name": "unique_reset_token",
      "type": "unique",
      "table": "password_reset_tokens",
      "fields": ["token"]
    }
  ]
}
